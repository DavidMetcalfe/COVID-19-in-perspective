<!doctype html>
<html>

<head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Causes of death compared with COVID-19</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
    <style>
        canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
        }

        body {
            margin-top: 35px;
        }

        #container {
            width: 95%;
            margin-left: auto;
            margin-right: auto;
            margin-bottom: auto;
        }

        .button {
            background-color: rgb(75, 192, 137);
            border: none;
            color: white;
            padding: 8px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            border-radius: 10px;
        }
    </style>
</head>

<body>
    <div id="container">
        <canvas id="canvas"></canvas>
    </div>

    <button title="Reveals all hidden data due to COVID-19 numbers being too low for the comparison to be useful."
        class="button" id="showAllData">Show
        all data</button>
    <button title="Compare COVID-19 with other pandemics, limited to 10x current COVID-19." class="button"
        id="pandemicsOnly">Pandemics only</button>
    <button title="Compare COVID-19 with all other pandemics." class="button" id="allPandemics">Show all
        pandemics</button>
    <button title="Set chart view back to what it was when the page loaded." class="button" id="resetView">Reset
        view</button>
    <a href="https://github.com/DavidMetcalfe/COVID-19-in-perspective" target="_self"><button class="button">Take me to
            Github</button></a>


    <script>
        function addCommas(nStr) {
            nStr += '';
            x = nStr.split('.');
            x1 = x[0];
            x2 = x.length > 1 ? '.' + x[1] : '';
            var rgx = /(\d+)(\d{3})/;
            while (rgx.test(x1)) {
                x1 = x1.replace(rgx, '$1' + ',' + '$2');
            }
            return x1 + x2;
        }

        window.chartColors = {
            red: 'rgb(255, 99, 132)',
            orange: 'rgb(255, 159, 64)',
            yellow: 'rgb(255, 205, 86)',
            green: 'rgb(75, 192, 192)',
            blue: 'rgb(54, 162, 235)',
            purple: 'rgb(153, 102, 255)',
            grey: 'rgb(201, 203, 207)'
        };

        //---------------------------------------------------------
        // Set up vars and arrays.
        //---------------------------------------------------------
        const COVID19 = 254592; // COVID-19 death total.
        const COVID19_Multiple = COVID19 * 10; // Upper bound of chart data to include.
        const annualDeaths = { 'Cardiovascular diseases': 17790000, 'Cancers': 9560000, 'Respiratory diseases': 3910000, 'Lower respiratory infections': 2560000, 'Dementia': 2510000, 'Digestive diseases': 2380000, 'Neonatal disorders': 1780000, 'Diarrheal diseases': 1570000, 'Diabetes': 1370000, 'Liver diseases': 1320000, 'Road injuries': 1240000, 'Kidney disease': 1230000, 'Tuberculosis': 1180000, 'HIV/AIDS': 954492, 'Suicide': 793823, 'Malaria': 619827, 'Homicide': 405346, 'Parkinson disease': 340639, 'Drowning': 295210, 'Meningitis': 288021, 'Nutritional deficiencies': 269997, 'COVID-19': COVID19, 'Protein-energy malnutrition': 231771, 'Maternal disorders': 193639, 'Alcohol use disorders': 184934, 'Drug use disorders': 166613, 'Conflict': 129720, 'Hepatitis': 126391, 'Fire': 120632, 'Poisonings': 72371, 'Heat (hot and cold exposure)': 53350, 'Terrorism': 26445, 'Natural disasters': 9603 }; // Key/Val pairs of deaths and causes.
        const pandemicDeaths = { "Black Death (Bubonic Plague)": 200000000, "Smallpox": 57000000, "Spanish Flu": 40000000, "Plague of Justinian": 30000000, "HIV/AIDS": 25000000, "The Third Plague": 12000000, "Antonine Plague": 5000000, "17th Century Great Plagues": 3000000, "Asian Flu": 1100000, "Russian Flu": 1000000, "Hong Kong Flu": 1000000, "Cholera": 1000000, "18th Century Great Plagues": 600000, "Influenza (Annual)": 470000, 'COVID-19': COVID19, "Swine Flu": 200000, "Yellow Fever": 150000, "Ebola": 11300, "MERS": 850, "SARS": 770 }; // Historical pandemics and their death tolls.        
        var defaultLabel = "2017 deaths by cause";
        var pandemicLabel = "Deaths by pandemic";
        var labels = []; // Placeholder array for labels.
        var data = []; // Placeholder array for data.
        var backgroundColors = []; // Placeholder array for styles.

        // Assign values to labels and data arrays.
        for (let [key, value] of Object.entries(annualDeaths)) {
            if (value <= COVID19_Multiple) {
                labels.push(key);
                data.push(value);
                if (key === "COVID-19") {
                    backgroundColors.push(window.chartColors.red);
                }
                else {
                    backgroundColors.push(window.chartColors.blue);
                }
            }

        };

        //---------------------------------------------------------
        // Chart config.
        //---------------------------------------------------------
        var color = Chart.helpers.color;
        var horizontalBarChartData = {
            labels: labels,
            datasets: [{
                label: defaultLabel,
                backgroundColor: color(window.chartColors.red).alpha(0.5).rgbString(),
                backgroundColor: backgroundColors,
                borderWidth: 1,
                data: data
            }]

        };


        //---------------------------------------------------------
        // Load chart on page load.
        //---------------------------------------------------------

        window.onload = function () {
            var ctx = document.getElementById('canvas').getContext('2d');
            window.myHorizontalBar = new Chart(ctx, {
                type: 'horizontalBar',
                data: horizontalBarChartData,
                options: {
                    // Elements options apply to all of the options unless overridden in a dataset
                    // In this case, we are setting the border of each horizontal bar to be 2px wide
                    elements: {
                        rectangle: {
                            borderWidth: 2,
                        }
                    },
                    responsive: true,
                    legend: {
                        display: false,
                    },
                    title: {
                        display: true,
                        text: '2017 deaths by cause (limited to 10x current COVID-19 toll) vs COVID-19 deaths'
                    }
                }
            });

        };

        //---------------------------------------------------------
        // Button JavaScript.
        //---------------------------------------------------------

        document.getElementById('showAllData').addEventListener('click', function () {

            // Reset arrays to empty so they can be populated again in an ordered fashion.
            labels.length = 0;
            data.length = 0;
            backgroundColors.length = 0;

            // Assign values to labels and data arrays.
            for (let [key, value] of Object.entries(annualDeaths)) {
                labels.push(key);
                data.push(value);
                if (key === "COVID-19") {
                    backgroundColors.push(window.chartColors.red);
                }
                else {
                    backgroundColors.push(window.chartColors.blue);
                }
            }

            horizontalBarChartData['datasets'][0]['label'] = defaultLabel;
            window.myHorizontalBar.data = horizontalBarChartData;
            window.myHorizontalBar.options.title.text = '2017 deaths by cause vs COVID-19 deaths';

            window.myHorizontalBar.update();
        });

        document.getElementById('pandemicsOnly').addEventListener('click', function () {

            // Reset arrays to empty so they can be populated again in an ordered fashion.
            labels.length = 0;
            data.length = 0;
            backgroundColors.length = 0;

            // Assign values to labels and data arrays.
            for (let [key, value] of Object.entries(pandemicDeaths)) {
                if (value <= COVID19_Multiple) {
                    labels.push(key);
                    data.push(value);
                    if (key === "COVID-19") {
                        backgroundColors.push(window.chartColors.red);
                    }
                    else {
                        backgroundColors.push(window.chartColors.blue);
                    }
                }
            }

            horizontalBarChartData['datasets'][0]['label'] = pandemicLabel;
            window.myHorizontalBar.data = horizontalBarChartData;
            window.myHorizontalBar.options.title.text = "Historical pandemic deaths (limited to 10x current COVID-19 toll) vs COVID-19 deaths";

            window.myHorizontalBar.update();

        });

        document.getElementById('allPandemics').addEventListener('click', function () {

            // Reset arrays to empty so they can be populated again in an ordered fashion.
            labels.length = 0;
            data.length = 0;
            backgroundColors.length = 0;

            // Assign values to labels and data arrays.
            for (let [key, value] of Object.entries(pandemicDeaths)) {
                labels.push(key);
                data.push(value);
                if (key === "COVID-19") {
                    backgroundColors.push(window.chartColors.red);
                }
                else {
                    backgroundColors.push(window.chartColors.blue);
                }
            }

            horizontalBarChartData['datasets'][0]['label'] = pandemicLabel;
            window.myHorizontalBar.data = horizontalBarChartData;
            window.myHorizontalBar.options.title.text = "Historical pandemic deaths vs COVID-19 deaths";

            window.myHorizontalBar.update();

        });

        document.getElementById('resetView').addEventListener('click', function () {

            // Reset arrays to empty so they can be populated again in an ordered fashion.
            labels.length = 0;
            data.length = 0;
            backgroundColors.length = 0;

            // Assign values to labels and data arrays.
            for (let [key, value] of Object.entries(annualDeaths)) {
                if (value <= COVID19_Multiple) {
                    labels.push(key);
                    data.push(value);
                    if (key === "COVID-19") {
                        backgroundColors.push(window.chartColors.red);
                    }
                    else {
                        backgroundColors.push(window.chartColors.blue);
                    }
                }
            }
            horizontalBarChartData['datasets'][0]['label'] = defaultLabel;
            window.myHorizontalBar.data = horizontalBarChartData;
            window.myHorizontalBar.options.title.text = '2017 deaths by cause (limited to 10x current COVID-19 toll) vs COVID-19 deaths';

            window.myHorizontalBar.update();
        });

    </script>
</body>

</html>